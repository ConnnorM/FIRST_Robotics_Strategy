{"version":3,"sources":["../../../../src/server/lib/incremental-cache/index.ts"],"names":["FileSystemCache","path","normalizePagePath","FetchCache","encode","encodeText","CACHE_ONE_YEAR","toRoute","pathname","replace","CacheHandler","constructor","_ctx","get","_key","_fetchCache","_fetchUrl","_fetchIdx","set","_data","revalidateTag","_tag","IncrementalCache","fs","dev","appDir","flushToDisk","fetchCache","minimalMode","serverDistDir","requestHeaders","requestProtocol","maxMemoryCacheSize","getPrerenderManifest","fetchCacheKeyPrefix","CurCacheHandler","allowedRevalidateHeaderKeys","process","env","__NEXT_TEST_MAX_ISR_CACHE","parseInt","prerenderManifest","revalidatedTags","preview","previewModeId","split","cacheHandler","_appDir","_requestHeaders","calculateRevalidate","fromTime","Date","getTime","initialRevalidateSeconds","routes","revalidateAfter","_getPathname","tag","fetchCacheKey","url","init","MAIN_KEY_PREFIX","cacheKey","bodyChunks","body","getReader","readableBody","reader","arrayBuffer","Uint8Array","processValue","done","value","push","curBuffer","prevBuffer","byteLength","err","console","error","read","then","_ogBody","keys","formData","key","Set","values","getAll","Promise","all","map","val","text","join","blob","Blob","type","cacheString","JSON","stringify","method","headers","mode","redirect","credentials","referrer","referrerPolicy","integrity","cache","NEXT_RUNTIME","bufferToHex","buffer","Array","prototype","call","b","toString","padStart","crypto","subtle","digest","require","createHash","update","revalidate","fetchUrl","fetchIdx","cacheData","entry","kind","age","Math","round","now","lastModified","isStale","data","curRevalidate","undefined","notFoundRoutes","includes","revalidateSeconds","length","Error","dataRoute","posix","srcRoute","warn"],"mappings":"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"}